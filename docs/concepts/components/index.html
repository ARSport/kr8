<!DOCTYPE html>
<html>
  <head>
    <title>kr8 documentation</title>
    
      <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="revised" content="2019-02-08T15:53:34 PST">
<title>Components :: kr8 documentation</title>
<link rel="shortcut icon" href="/images/favicon.png" type="image/x-icon" />
<link href="/css/font-awesome.min.css" rel="stylesheet">
<link href="/css/nucleus.css" rel="stylesheet">
<link href="/theme-flex/style.css" rel="stylesheet">

	<link href="/theme-flex/variant-gold.css" rel="stylesheet">

<link rel="stylesheet" href="/css/bootstrap.min.css">
<script src="/js/jquery-2.x.min.js"></script>
<script type="text/javascript">
      var baseurl = "https:\/\/kr8.rocks";
</script>
<meta name="description" content="">



    
  </head>
  <body data-url="/concepts/components/">
    
      <header>
  <div class="logo">
    
	
  
    <a class="baselink" href="https://kr8.rocks">kr8 documentation</a>
  


  </div>
  <div class="burger"><a href="javascript:void(0);" style="font-size:15px;">&#9776;</a></div>
    <nav class="shortcuts">
            <li class="" role="">
                <a href="https://github.com/apptio/kr8"  rel="noopener">
                  <i class='fa fa-github'></i> <label>Github repo</label>
                </a>
            </li>
            <li class="" role="">
                <a href="https://github.com/apptio/kr8/releases"  rel="noopener">
                  <i class='fa fa-cloud-download'></i> <label>Download</label>
                </a>
            </li>
    </nav>
</header>
<article>
  <aside>
    <ul class="menu">
          <li data-nav-id="/" class="dd-item">
          <a href="/">
            <i class="fa fa-fw fa-home"></i>
          </a>
          </li>
    <li data-nav-id="/about/" class="dd-item
        ">
      <div>
      <a href="/about/">About</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/installation/" class="dd-item
        ">
      <div>
      <a href="/installation/">Installation</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/" class="dd-item parent haschildren
        ">
      <div>
      <a href="/concepts/">Concepts</a>
            <i class="fa fa-angle-down fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/concepts/components/" class="dd-item parent active
        ">
      <div>
      <a href="/concepts/components/">Components</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/concepts/clusters/" class="dd-item
        ">
      <div>
      <a href="/concepts/clusters/">Clusters</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
        </ul>
    </li>
    <li data-nav-id="/getting-started/" class="dd-item
        ">
      <div>
      <a href="/getting-started/">Getting Started</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>
    <li data-nav-id="/advanced/" class="dd-item haschildren
        ">
      <div>
      <a href="/advanced/">Advanced</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
    <li data-nav-id="/advanced/components/" class="dd-item haschildren
        ">
      <div>
      <a href="/advanced/components/">Components</a><i class="fa fa-angle-right fa-lg category-icon"></i><i class="fa fa-circle-thin read-icon"></i>
      </div>
        <ul>
      <li data-nav-id="/advanced/components/helm/" class="dd-item">
        <div>
          <a href="/advanced/components/helm/">
            Helm Components
          </a><i class="fa fa-circle-thin read-icon"></i>
        </div>
    </li>
        </ul>
    </li>
        </ul>
    </li>
    <li data-nav-id="/contributing/" class="dd-item
        ">
      <div>
      <a href="/contributing/">Contributing</a><i class="fa fa-circle-thin read-icon"></i>
      </div>
    </li>




    </ul>
    <section>
    </section>
  </aside>
  <section class="page">
    
    <div class="nav-select">
      <center>Navigation : 
        <select onchange="javascript:location.href = this.value;">
          
    <option value="/about/" >
   About</option>
    <option value="/installation/" >
   Installation</option>
    <option value="/concepts/" >
   Concepts</option> 
    <option value="/concepts/components/"  selected>
  - 
   Components</option> 
  
    <option value="/concepts/clusters/" >
  - 
   Clusters</option>
  
    <option value="/getting-started/" >
   Getting Started</option>
    <option value="/advanced/" >
   Advanced</option>
    <option value="/contributing/" >
   Contributing</option>



        </select>
      </center>
    </div>
      <div>
        <div class="searchbox">
          <input data-search-input id="search-by" type="text" placeholder="Search...">
        </div>
        <script type="text/javascript" src="/js/lunr.min.js"></script>
        <script type="text/javascript" src="/js/auto-complete.js"></script>
        <link href="/css/auto-complete.css" rel="stylesheet">
        <script type="text/javascript">
          
              var baseurl = "https:\/\/kr8.rocks";
          
        </script>
        <script type="text/javascript" src="/js/search.js"></script>
      </div>
    

    <h1>Components</h1>
    
    
    



<h1 id="components">Components</h1>

<p>A component is a deployable unit that you wish to install to multiple clusters.</p>

<p>Your component might begin life before kr8 in one of a few ways:</p>

<ul>
<li>a <a href="https://github.com/helm/charts/tree/master/stable">Helm Chart</a></li>
<li>a static <a href="https://github.com/kubernetes/examples/blob/master/guestbook/all-in-one/guestbook-all-in-one.yaml">YAML manifest</a></li>
<li>some <a href="https://github.com/coreos/prometheus-operator/tree/master/jsonnet/prometheus-operator">Jsonnet</a></li>
</ul>

<p>but they all have something in common - you need to deploy it to multiple clusters with slight differences in configuration.</p>

<h2 id="component-components">Component components</h2>

<p>There are several key pieces that make up a component before you write a line of configuration.</p>

<h2 id="taskfile">Taskfile</h2>

<p>This task file lives inside the component directory. It should contain two tasks:</p>

<ul>
<li>fetch - a manually run task which downloads all the components&rsquo; dependencies (for example, helm chart or static manifest)</li>
<li>generate - this is the task that&rsquo;s run when kr8 generates the manifest for the cluster</li>
</ul>

<p>These tasks will be highly dependent on the particular component - for example, a component using a helm chart will generally have a different set of fetch and generate tasks to a component using a static manifest.</p>

<p>An example Taskfile might look like this:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">version<span style="color:#111">:</span> <span style="color:#ae81ff">2</span>

vars<span style="color:#111">:</span>
  KR8_COMPONENT<span style="color:#111">:</span> kubemonkey

tasks<span style="color:#111">:</span>
  fetch<span style="color:#111">:</span>
    desc<span style="color:#111">:</span> <span style="color:#d88200">&#34;fetch component kubemonkey&#34;</span>
    cmds<span style="color:#111">:</span>
      - curl -L https<span style="color:#111">:</span>//github.com/asobti/kube-monkey/tarball/master &gt; kubemonkey.tar.gz <span style="color:#75715e"># download the local helm chart from the git repo</span>
      - tar --strip-components=<span style="color:#ae81ff">2</span> -xzvf kubemonkey.tar.gz asobti-kube-monkey-{{.GIT_COMMIT}}/helm <span style="color:#75715e"># extract it</span>
      - mv kubemonkey charts <span style="color:#75715e"># place it in a charts directory</span>
      - rm -fr <span style="color:#75715e">*.tar.gz</span> <span style="color:#75715e"># remove the tar.gz from the repo</span>
    vars<span style="color:#111">:</span>
      GIT_COMMIT<span style="color:#111">:</span>
        sh<span style="color:#111">:</span> curl -s https<span style="color:#111">:</span>//api.github.com/repos/asobti/kube-monkey/commits/master | jq .sha -r | xargs git rev-parse --short

  generate<span style="color:#111">:</span>
    desc<span style="color:#111">:</span> <span style="color:#d88200">&#34;generate&#34;</span>
    cmds<span style="color:#111">:</span>
      - KR8_COMPONENT={{.KR8_COMPONENT}} kr8-helpers clean-output <span style="color:#75715e"># clean the tmp directories each time we generate</span>
      - KR8_COMPONENT={{.KR8_COMPONENT}} kr8-helpers helm-render-with-patch <span style="color:#d88200">&#34;{{.KR8_COMPONENT}}&#34;</span> patches.jsonnet <span style="color:#75715e"># our generate command, which in this case is a helm-render with some patches in a jsonnet file</span></code></pre></div>
<h2 id="params">Params</h2>

<p>kr8&rsquo;s most useful feature is the ability to configure <em>parameters</em> for a specific cluster. It does that by specifying a <code>params.jsonnet</code> in each component.</p>

<p>There are some <em>required</em> parameters which always must exist. They are:</p>

<ul>
<li><code>namespace</code>: the namespace the component should be installed in</li>
<li><code>release_name</code>: analogous to a helm release - what the component should be called when it&rsquo;s installed into a cluster</li>
<li><code>kubecfg_gc_enable</code>: whether this component should be garbage collected when the deployer script cleans up this component (generally should be false for important system components like namespaces)</li>
</ul>

<p>Without these parameters, components will not install a function. A barebones <code>params.jsonnet</code> would look like this:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsonnet" data-lang="jsonnet">{
  namespace: &#39;kubemonkey&#39;,
  release_name: &#39;kubemonkey&#39;,
  kubecfg_gc_enable: true,
}</code></pre></div>
<h3 id="cluster-specific-parameters">Cluster specific parameters</h3>

<p>Once you start to install components into clusters, you&rsquo;ll want to specify parameters of your own.</p>

<p>These are done in the <code>params.jsonnet</code> and you can either specify a default, or make it mandatory using jsonnet&rsquo;s <code>error</code>.</p>

<p>Here&rsquo;s an more detailed example:</p>
<div class="highlight"><pre style="color:#272822;background-color:#fafafa;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-jsonnet" data-lang="jsonnet">{
  namespace: &#39;kubemonkey&#39;,
  release_name: &#39;kubemonkey&#39;,
  kubecfg_gc_enable: true,
  dry_run: false,
  run_hour: error &#39;Must specify a time for kubemonkey to run&#39;
}</code></pre></div>
<h2 id="manifests">Manifests</h2>

<p>The final part of your component is the actual manifest generation. This depends on the source you&rsquo;re generating from. You can find more information about how to generate manifests in the <a href="/advanced/components/">advanced components</a> section of the documentation</p>



    
    
        <div class="chevrons">
    <div id="navigation">
<a class="nav nav-prev" href="/concepts/" title="Concepts"> <i class="fa fa-chevron-left"></i><label>Concepts</label></a>
    <a class="nav nav-next" href="/concepts/clusters/" title="Clusters" style="margin-right: 0px;"><label>Clusters</label><i class="fa fa-chevron-right"></i></a></div>
  </div>

  </section>
</article>

<footer>

<div class="footline">
    

    

    

    
    <div class="github-link">
      <a href="https://github.com/apptio/kr8/docsconcepts/components/_index.md" target="blank"><i class="fa fa-code-fork"></i>
        Improve this page</a>
    </div>
    
  </div>


	<div>


  
    <p>Made with love <a href="https://apptio.com">@apptio</a></p>

  



	</div>
</footer>

<script src="/js/clipboard.min.js"></script>

<link href="/css/featherlight.min.css" rel="stylesheet">
<script src="/js/featherlight.min.js"></script>



<script src="/theme-flex/script.js"></script>


    

    
    

    
  </body>
</html>